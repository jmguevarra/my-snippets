<!--
    templateType: page
    isAvailableForNewContent: true
    label: Booking Proposal Form Entries
-->


{% extends ".././layouts/booking-app-base.html" %}

{% block bnts_style_page %}
<style type="text/css">
  .table-scroll{
    padding-bottom: 150px;
  }
  .table-scroll table {
    width: 2800px;
  }
  tr.form-entry.has-conflict > td {
    background-color: transparent;
  }
  tr.form-entry.has-conflict {
    background-color: var(--bs-warning);
  }    
  .conflict-info {
    left: 20px;
    width: 100%;
    max-width: 280px;
    top: -40px;
    background-color: #fff !important;
    box-shadow: 0 0 10px 0px rgba(0, 0, 0, 0.5) !important;
    border-radius: 5px;
    padding: 20px !important;
    z-index: 999;
  }
</style>
{% endblock bnts_style_page %}
{% block body %}
<section class="bnts-wrapper form-entries">
  <div id="ftable-entries" class="bnts-table book-consultation">
    <div class="table-controller flex justify-content-between align-items-end">
      <div class="page-title">
        <h4 class="mb-0">Pre-booked Entries</h4>
      </div>
      <div class="controller-inputs flex align-items-end">
<!--         <a class="btn btn-primary me-1 text-decoration-none" href="https://mp.kongo.melbourne/book-program">Add</a> -->
        <input class="search form-control mt-0" type="text" placeholder="Search any keyword" />
      </div>
    </div>
    <div class="table-scroll">
      <table class="table table-striped">
        <thead> 
          <tr>
            <th class="form-entry-header rowno">No.</th>
            <th class="form-entry-header firstname">First Name</th>
            <th class="form-entry-header lastname">Last Name</th>
            <th class="form-entry-header email">Email</th>
            <th class="form-entry-header phone">Phone Number</th>
            <th class="form-entry-header school">School</th>
            <th class="form-entry-header program">Program</th>
            <th class="form-entry-header room">Room</th>
            <th class="form-entry-header bkcons_bus_transportation">Bus Transportation Needed</th>
            <th class="form-entry-header location-site">Location Site</th>
            <th class="form-entry-header booking-startdatetime">Booking Start Date</th>
            <th class="form-entry-header booking-enddatetime">Booking End Date</th>
            <th class="form-entry-header number-of-teachers">No. of Teachers</th>
            <th class="form-entry-header number-of-students">No. of Students</th>
            <th class="form-entry-header additional-notes">Additional Notes</th>
            <th class="form-entry-header staffing-needs">Staffing Needs</th>
            <th class="form-entry-header learning-outcome">Learning Outcome</th>
            <th class="controller">Actions</th>
            
          </tr>
        </thead>
        <tbody class="list">
        </tbody>
      </table>
    </div>
    <nav aria-label="Table Pagination">
      <ul class="pagination">
      </ul>
    </nav>
  </div>
</section>

<!--- Approval Modal --->
<div class="modal fade" id="approval-modal" tabindex="-1" role="dialog" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-capitalize" id="eventModalLabel">Booking Program - <span class="modal-id"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="infosec contant-info">
          <h3 class="infosec-title">Contact Info</h3>
          <div class="info-group-wrap col2">
            <div class="info-wrap firstname">
              <h6 class="title">Frstname </h6>
              <label>Jaime</label>
            </div>
            <div class="info-wrap lastname">
              <h6 class="title">Lastname </h6>
              <label>Guevarra</label>
            </div>
          </div>
          <div class="info-group-wrap col2">
            <div class="info-wrap email">
              <h6 class="title">Email </h6>
              <label>jaimeteste@sg.com</label>
            </div>
            <div class="info-wrap phone">
              <h6 class="title">Phone </h6>
              <label>09125213454</label>
            </div>
          </div>
          <div class="info-group-wrap col2">
            <div class="info-wrap school">
              <h6 class="title">School </h6>
              <label>BNTS</label>
            </div>
          </div>
        </div>
        <div class="infosec booking-info">
          <h3 class="infosec-title">Booking Details</h3>
          <div class="accordion" id="accor-booking">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#accor-item-consultation" aria-expanded="true" aria-controls="accor-item-consultation">
                  Consultation
                </button>
              </h2>
              <div id="accor-item-consultation" class="accordion-collapse collapse show" data-bs-parent="#accor-booking">
                <div class="accordion-body">
                  <div class="info-group-wrap col2">
                    <div class="info-wrap bkcons_program_length">
                      <h6 class="title">How long will the program be?</h6>
                      <label></label>
                    </div>
                    <div class="info-wrap bkcons_location_site">
                      <h6 class="title">How much will be done in school/on-site</h6>
                      <label></label>
                    </div>
                  </div>
                  <div class="info-wrap bkcons_learning_outcomes">
                    <h6 class="title">What are the expected learning outcomes</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_equipments">
                    <h6 class="title">What are the technologies/equipments required?</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_softwares">
                    <h6 class="title">What are the softwares required?</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_bus_transportation">
                    <h6 class="title">Bus Transportation Needed</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_programs">
                    <h6 class="title">Recommended Learning Experience</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_room">
                    <h6 class="title">Recommended room/space</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_staffing_needs">
                    <h6 class="title">Staffing needs</h6>
                    <label></label>
                  </div>
                  <div class="info-wrap bkcons_additional_notes">
                    <h6 class="title">Additional Notes</h6>
                    <label></label>
                  </div>
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accor-item-prebooking" aria-expanded="false" aria-controls="accor-item-prebooking">
                  Pre-Booking
                </button>
              </h2>
              <div id="accor-item-prebooking" class="accordion-collapse collapse" data-bs-parent="#accor-booking">
                <div class="accordion-body">

                  <div class="info-group-wrap col2">
                    <div class="info-wrap bkpros_start_date">
                      <h6 class="title">Start Date </h6>
                      <label></label>
                    </div>
                    <div class="info-wrap bkpros_start_time">
                      <h6 class="title">Time: </h6>
                      <label></label>
                    </div>
                  </div>

                  <div class="info-group-wrap col2">
                    <div class="info-wrap bkpros_end_date">
                      <h6 class="title">End Date </h6>
                      <label></label>
                    </div>
                    <div class="info-wrap bkpros_end_time">
                      <h6 class="title">Time </h6>
                      <label></label>
                    </div>
                  </div>

                  <div class="info-group-wrap col3">
                    <div class="info-wrap bkpros_teachers_number">
                      <h6 class="title">Number of Teachers </h6>
                      <label></label>
                    </div>
                    <div class="info-wrap bkpros_students_number">
                      <h6 class="title">Number of Students </h6>
                      <label></label>
                    </div>
                    <div class="info-wrap bkpros_year_level">
                      <h6 class="title">Year Level </h6>
                      <label></label>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-dark btn-modal-close" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary btn-modal-approval">Approve</button>
      </div>
    </div>
  </div>
</div>
<!--- End of Approval Modal --->
<!--- Confirmation --->
<div class="modal fade" id="confirmationDialog" tabindex="-1" aria-labelledby="confirmationDialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Booking Confirmation</h1>
      </div>
      <div class="modal-body default">
        Are you sure you want to approve this record?
      </div>
      <div class="modal-body loader text-center" style="display:none;">
        <span class="mb-1 d-block">Loading...</span>
        <svg width="40" height="40" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><style>.spinner_ajPY{transform-origin:center;animation:spinner_AtaB .75s infinite linear}@keyframes spinner_AtaB{100%{transform:rotate(360deg)}}</style><path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"></path><path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" class="spinner_ajPY"></path></svg>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-dark" data-bs-dismiss="modal">No</button>
        <button type="button" class="btn btn-primary btn-confirm-yes">Yes</button>
      </div>
    </div>
  </div>
</div>
<!--- End of Confirmation ---> 
{% endblock body %}
{# HUBL Variables #}

{#  Get reference values on some table by Id and conditioning with IN clause #}
{% macro getRowsRefsIn(tableId, property, values) %}
{% set objProps = [] %}
{% set objRows = hubdb_table_rows(tableId)|selectattr(property, "in", values) %}

{% for obj in objRows %}
{%
        set objProp = {
          "id": obj.hs_id,
          "name": obj.name
        }
      %}
{% do objProps.append(objProp) %}
{% endfor %}

{{objProps | tojson}}
{% endmacro %}
{# End HUBL Variables #}

{% block bnts_script_page %}
<script src="//cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    
    const fourMonthsBooked = async () => {
      try {
        const response = await fetch("https://mp.kongo.melbourne/_hcms/api/booking/getbookedbymonths");
        if (response.ok) {
          const data = await response.json();
          if (data){
            return data.rows.map(x => {
              return {
                id: x.id,
                program: x.values.program[0].name,
                room: x.values.room[0].name,
                startDate: new Date(x.values.booking_start_date).getTime(),
                endDate: new Date(x.values.booking_end_date).getTime()
              }
            });
          }
        }
      } catch (error) {
        console.error(error);
        return [];
      }
    };

    const formEntries = async () => {
      const formEntriesEURL = "https://mp.kongo.melbourne/_hcms/api/form-entries?form_type=Booking%20Proposal";
      try {
        const response = await fetch(formEntriesEURL);
        if (response.ok) {
          const data = await response.json();
          if (data.length > 0) return data;
        }
      } catch (error) {
        console.error(error);
        return [];
      }
    };


    const formListInit = async ()=>{
      const booked = await fourMonthsBooked();
      const entries = await formEntries();
      const tableContainer = $('.bnts-table table');
      const tableList = tableContainer.find('tbody.list');
 
      
      if(entries && entries.length > 0){
        entries.forEach((item, index) => {
          const startDate = new Date(`${item.properties.bkpros_start_date} ${item.properties.bkpros_start_time}`).getTime();
          const endDate = new Date(`${item.properties.bkpros_end_date} ${item.properties.bkpros_end_time}`).getTime();
          const bookedRows = booked.filter(x => startDate <= x.endDate && endDate >= x.startDate && (x.program.toLowerCase() == item.properties.bkcons_programs.toLowerCase() || x.room.toLowerCase() == item.properties.bkcons_room.toLowerCase()));
          const otherProps = encodeURIComponent(JSON.stringify(item));
         
//           const sameDateOfBooked = booked
//           const roomNotAvailable = 
//           const programNotAvailable = 
          const listHTML = `
            <tr class="form-entry bnts-form-entry-${index} ${bookedRows.length > 0 ? 'has-conflict': ''}">
              <td class="form-entry-property rowno">${index + 1}</td>
              <td class="form-entry-property firstname">${item.firstname}</td>
              <td class="form-entry-property lastname">${item.lastname}</td>
              <td class="form-entry-property email">${item.email}</td>
              <td class="form-entry-property phone">${item.mobilephone}</td>
              <td class="form-entry-property school">${item.bnts_school ?? ''}</td>
              <td class="form-entry-property program">${item.properties.bkcons_programs ?? ''}</td>
              <td class="form-entry-property room">${item.properties.bkcons_room ?? ''}</td>
              <td class="form-entry-property bkcons_bus_transportation">${item.properties.bkcons_bus_transportation ?? ''}</td>
              <td class="form-entry-property location-site">${item.properties.bkcons_location_site ?? ''}</td>
              <td class="form-entry-property booking-startdatetime">${moment(item.properties.bkpros_start_date).format('MMMM Do YYYY')} | ${item.properties.bkpros_start_time}</td>
              <td class="form-entry-property booking-enddatetime">${moment(item.properties.bkpros_end_date).format('MMMM Do YYYY')} | ${item.properties.bkpros_end_time}</td>
              <td class="form-entry-property number-of-teachers">${item.properties.bkpros_teachers_number ?? '0'}</td>
              <td class="form-entry-property number-of-students">${item.properties.bkpros_students_number ?? '0'}</td>
              <td class="form-entry-property additional-notes">${item.properties.bkcons_additional_notes ?? ''}</td>
              <td class="form-entry-property staffing-needs">${item.properties.bkcons_staffing_needs ?? ''}</td>
              <td class="form-entry-property learning-outcome">${item.properties.bkcons_learning_outcomes ?? ''}</td>
              <td class="form-entry-action update">
                <div class="d-flex justify-content-center px-1">
                  <input type="button" class="btn btn-secondary btn-update small me-1" value="Update" data-entryid="${item.formEntryId}" data-entryprops="${otherProps}"> 
                  <input type="button" class="btn btn-primary btn-approval small" value="Approval" data-entryid="${item.formEntryId}" data-entryprops="${otherProps}">
                </div>
              </td>
             </tr>
          `;

          tableList.append(listHTML);
          
          //Conflict Info
          if(bookedRows.length > 0){
            const rowConflict = $(tableList).find('tr.form-entry.has-conflict');
            rowConflict.append(`<div class="conflict-info hide position-absolute">
              <h6>Conflict Info:</h6>
              <span><span class="fw-bold">ID:</span> ${bookedRows[0].id}</span><br>
              <span><span class="fw-bold">Program:</span> ${bookedRows[0].program}</span><br>
              <span><span class="fw-bold">Room:</span> ${bookedRows[0].room}</span><br>
              <span><span class="fw-bold">Start Date:</span> ${moment(bookedRows[0].startDate).format('DD/MM/YYYY | hh:mm A') }</span><br>
               <span><span class="fw-bold">End Date:</span> ${moment(bookedRows[0].endDate).format('DD/MM/YYYY | hh:mm A') }</span>
            </div>`);
            const conflictInfo = rowConflict.find(".conflict-info");
            rowConflict.on('mouseenter', function(event) {
              let mouseX = event.clientX + $('.table-scroll').scrollLeft();
              const mouseY = event.cleintY;
              
              if(mouseX > ($('.table-scroll table').width() / 2)){
                mouseX = mouseX - (conflictInfo.outerWidth() * 2);
              }else{
                mouseX = mouseX - conflictInfo.outerWidth()
              }
              conflictInfo.css({
                left: mouseX + 'px',
                top: (mouseY - conflictInfo.outerHeight()) + 'px',
              });
              conflictInfo.removeClass('hide');
            });
            rowConflict.on('mousemove', function(event) {
              let mouseX = event.clientX + $('.table-scroll').scrollLeft();
              const mouseY = event.clientY;

              if(mouseX > ($('.table-scroll table').width() / 2)){
                mouseX = mouseX - (conflictInfo.outerWidth() * 2);
              }else{
                mouseX = mouseX - conflictInfo.outerWidth()
              }
              conflictInfo.css({
                left: mouseX + 'px',
                top: (mouseY - conflictInfo.outerHeight()) + 'px',
              });
            });
            rowConflict.on('mouseleave', function() {
              conflictInfo.addClass('hide');
            });

          }
        });


        const options = {
          valueNames: ['rowno', 'firstname', 'lastname', 'email', 'phone', 'school"', 'program', 'room', 'location-site', 'booking-startdatetime', 'booking-enddatetime', 'number-of-teachers', 'number-of-students', 'additional-notes', 'staffing-needs', 'learning-outcome'],
          pagination: true,
        };
        const formList = new List('ftable-entries', options);
        $('input[type="button"].btn-update').click(function(e){
          const obj = JSON.parse(decodeURIComponent($(this).attr("data-entryprops")));
          //           const redirectURL = `https://mp.kongo.melbourne/book-program?action=update&
          //             firstname=${obj.firstname}&
          //             lastname=${obj.lastname}&
          //             email=${obj.email}&
          //             mobilephone=${obj.mobilephone}&
          //             bnts_school=${obj.bnts_school}&
          //             bkpros_start_date=${obj.properties.bkpros_start_date}&
          //             bkpros_end_date=${obj.properties.bkpros_end_date}&
          //             bkpros_start_time=${obj.properties.bkpros_start_time}&
          //             bkpros_end_time=${obj.properties.bkpros_end_time}&
          //             bkpros_students_number=${obj.properties.bkpros_students_number}&
          //             bkpros_teachers_number=${obj.properties.bkpros_teachers_number}&
          //             bkpros_year_level=${obj.properties.bkpros_year_level}&            
          //             form_id=${obj.properties.form_id}&
          //             form_label=${obj.properties.form_label}&
          //             form_type=${obj.properties.form_type}
          //           `;
          const redirectURL = `https://mp.kongo.melbourne/book-program?form_actioned=Update&firstname=${obj.firstname}&lastname=${obj.lastname}&email=${obj.email}&mobilephone=${obj.mobilephone}&bnts_school=${obj.bnts_school}&bkpros_start_date=${obj.properties.bkpros_start_date}&bkpros_end_date=${obj.properties.bkpros_end_date}&bkpros_start_time=${obj.properties.bkpros_start_time}&bkpros_end_time=${obj.properties.bkpros_end_time}&bkpros_students_number=${obj.properties.bkpros_students_number}&bkpros_teachers_number=${obj.properties.bkpros_teachers_number}&bkpros_year_level=${obj.properties.bkpros_year_level}&form_id=${obj.properties.form_id}&form_label=${obj.properties.form_label}&form_type=${obj.properties.form_type}`;
          location.href = redirectURL;
        });

        $('.btn-modal-close').click(function(){
          localStorage.setItem("bnts-selected-approval-data", null);
        });

        $('input[type="button"].btn-approval').click(function(e){
          const obj = JSON.parse(decodeURIComponent($(this).attr("data-entryprops")));
          localStorage.setItem("bnts-selected-approval-data", $(this).attr("data-entryprops"));

          $('.modal-id').text(obj.formEntryId);
          const multiChoices = [
            'bkcons_equipments',
            'bkcons_softwares',
          ];
          const elementClasses = [
            'firstname',
            'lastname',
            'mobilephone',
            'email',
            'bnts_school',
            'bkcons_program_length',
            'bkcons_location_site',
            'bkcons_school_cost',
            'bkcons_learning_outcomes',
            'bkcons_equipments',
            'bkcons_softwares',
            'bkcons_programs',
            'bkcons_room',
            'bkcons_bus_transportation',
            'bkcons_additional_notes',
            'bkcons_staffing_needs',
            'bkpros_start_date', 
            'bkpros_start_time', 
            'bkpros_end_date',
            'bkpros_end_time',
            'bkpros_teachers_number',
            'bkpros_students_number',
            'bkpros_year_level',
          ];

          elementClasses.forEach(item =>{
            if(item.includes("date")){
              const mStartDate = moment(obj.properties.bkpros_start_date).format('MMMM Do YYYY');
              const mEndDate = moment(obj.properties.bkpros_end_date).format('MMMM Do YYYY');
              if(item.includes("start")){
                $(`.info-wrap.${item} label`).text(mStartDate);
              }else if(item.includes("end")){
                $(`.info-wrap.${item} label`).text(mEndDate);
              }
            }else if(multiChoices.includes(item)){
              $(`.info-wrap.${item} label`).html('');
              if(obj.properties[item]){
                const choices = obj.properties[item].split(";");
                choices.forEach(choice => {
                  $(`.info-wrap.${item} label`).append(`<span class="choice-value">${choice}</span>`);
                });     
              }
            }else if(item.includes('bkpros') || item.includes('bkcons')){
              $(`.info-wrap.${item} label`).text(obj.properties[item]);
            }else{
              $(`.info-wrap.${item} label`).text(obj[item]);
            }
          });

          const approvalModalElement = document.getElementById('approval-modal');
          const modal = new bootstrap.Modal(approvalModalElement, {
            keyboard: false,
          });
          modal.show();
        });



        /*** Confirmation ***/
        $('.btn-modal-approval').click(function(e){
          $('#approval-modal').modal("hide");
          const confirmationDialog = document.getElementById('confirmationDialog');
          const modal = new bootstrap.Modal(confirmationDialog, {
            keyboard: false,
            backdrop: 'static',
          });
          modal.show();
          confirmationDialog.addEventListener('hidden.bs.modal', event => {
            $('#approval-modal').modal("show");
          });
        });

        //*** Saving here **/
        $('.btn-confirm-yes').click(async function(){
          const dataStored = localStorage.getItem("bnts-selected-approval-data");
          const obj = JSON.parse(decodeURIComponent(dataStored));
          const baseEURL = "https://mp.kongo.melbourne/_hcms/api/booking/refs";

          $(confirmationDialog).find(".modal-body.default, .modal-footer").hide();
          $(confirmationDialog).find(".modal-body.loader").show('slow');

          const softwaresRes = await fetch(`${baseEURL}?tableId=21545737&prop=name&values=${obj.properties.bkcons_softwares}`);
          const softwares = await softwaresRes.json();

          const equipmentRes =  await fetch(`${baseEURL}?tableId=5248771&prop=name&values=${obj.properties.bkcons_equipments}`);
          const equipment = await equipmentRes.json();

          const roomRes =  await fetch(`${baseEURL}?tableId=3410912&prop=name&values=${obj.properties.bkcons_room}`);
          const room = await roomRes.json();

          console.log(room, obj.properties.bkcons_room, obj)
          const programRes =  await fetch(`${baseEURL}?tableId=3410283&prop=name&values=${obj.properties.bkcons_programs}`);
          const program = await programRes.json();
         
          const bookStartStr = `${obj.properties.bkpros_start_date} ${obj.properties.bkpros_start_time}`;
          const bookEndStr = `${obj.properties.bkpros_end_date} ${obj.properties.bkpros_end_time}`;
          const bookStart = new Date(bookStartStr);
          const bookEnd = new Date(bookEndStr);

          const rowData = {
            "values": {
              "crm_contact_id": obj.contactId,
              "crm_form_entry_id": obj.formEntryId,
              "fullname": `${obj.firstname} ${obj.lastname}`,
              "email": obj.email,
              "mobilephone": obj.mobilephone,
              "school": obj.bnts_school,
              "softwares": softwares,
              "equipments": equipment,
              "room": room,
              "program": program,
              "status": { "id": "1", "type": "option"},
              "staffing_needs": obj.properties.bkcons_staffing_needs,
              "additional_notes": obj.properties.bkcons_additional_notes,
              "number_of_students": parseInt(obj.properties.bkpros_students_number),
              "number_of_teachers": parseInt(obj.properties.bkpros_teachers_number),
              "year_level": obj.properties.bkpros_year_level,
              "booking_start_date": bookStart.getTime(),
              "booking_end_date": bookEnd.getTime()
            }
          };
          const config = {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(rowData)
          };

          fetch(`https://mp.kongo.melbourne/_hcms/api/booking/add`, config)
            .then(res => res.ok ? res.json() : Promise.reject(res))
            .then(data => {
            const modalBodyDefault = $(confirmationDialog).find(".modal-body.default");
            modalBodyDefault.show();
            $(confirmationDialog).find(".modal-body.loader").hide();
            modalBodyDefault.text("Record saved successfully!");

            setTimeout(()=> location.reload(), 3000);
          })
            .catch(error => {
            console.error(error);
          });           
        });
        /*** Confirmation ***/

      }else{
         const listHTML = `
            <tr class="form-entry bnts-form-entry-0">
             <td colspan="20" class="p-5"><span>No data found.</span></td>
            </tr>
          `;
          tableList.append(listHTML);
      }
    }

    formListInit();  





  });
</script>
{% endblock bnts_script_page %}

